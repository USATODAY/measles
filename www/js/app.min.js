var mobile=mobile||{};mobile.panelHead=jQuery("#panel-head"),mobile.panelSub=jQuery("#panel-sub"),mobile.arrPanelData=jQuery(".panel-data"),mobile.dataCharts=jQuery(".data-charts"),mobile.dataListItems=jQuery(".data-list").find("li"),mobile.panelWrap=jQuery(".panel-wrap"),mobile.dataWrap=jQuery(".data-wrap"),mobile.stateMenu=jQuery(".state-menu"),mobile.arrDataText=jQuery(".data-text"),mobile.arrDataNumbers=jQuery(".data-number"),mobile.arrPies=jQuery(".pie-box"),mobile.dataContainer=jQuery(".data-container"),mobile.chatterBox=jQuery(".mobile-company-info-box"),mobile.arrStateText=["Use the search section above to find your school.","Use the search section above to find your school.","Use the search section above to find your school.","Use the search section above to find your school.","Illinois’ data includes all students K-12.","Massachusetts’ Medical Exemption rate includes both medical and religious exemptions. In Massachusetts, data for schools with fewer than 30 kindergartners has been redacted.","Minnesota’s Medical Exemption rate includes both medical and conscientious objections.","Use the search section above to find your school.","New York’s data includes all students K-12. The MMR rate references the percentage of students who specifically have been vaccinated for measles.","Use the search section above to find your school.","In Virginia, the location of each school refers to the state health district.","Vermont’s data includes all students K-12.","In West Virginia, data for schools with fewer than 30 kindergartners has been redacted."],mobile.currentFocus=null,mobile.blnSmallScrn=!1,$(window).width()<800&&(mobile.blnSmallScrn=!0),mobile.setPanelInfo=function(data){null===data?(mobile.panelHead.empty(),mobile.panelSub.empty(),mobile.dataCharts.removeClass("show"),mobile.arrPanelData.eq(0).addClass("hidden"),mobile.dataListItems.empty()):(mobile.panelWrap.eq(0).show(),mobile.dataCharts.addClass("show"),mobile.panelHead.text(data.Name),mobile.panelSub.show(),mobile.drawChart(data),mobile.renderTable(data))},mobile.renderTable=function(prop){var numParam,strHTML="";strHTML+='<table class="data-table" cellspacing="0" cellpadding="0" border="0">',strHTML+="    <tr>",strHTML+="        <td>Measles, Mumps, Rubella</td>",numParam=prop.MMR,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Diphtheria, Tetanus, Pertussis</td>",numParam=prop.DTaP,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Polio</td>",numParam=prop.Polio,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Hepatitis B</td>",numParam=prop.HepB,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Varicella</td>",numParam=prop.Varicella,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Medical Exemptions</td>",numParam=prop.Medical,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Philosophical Exemptions</td>",numParam=prop.Philosophical,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Religious Exemptions</td>",numParam=prop.Religious,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="    <tr>",strHTML+="        <td>Missing Records</td>",numParam=prop.NoRecords,strHTML+=isNaN(numParam)||""===numParam?"        <td>NA</td>":"        <td>"+(Math.round(1e4*numParam)/100).toString()+"%</td>",strHTML+="    </tr>",strHTML+="</table>",mobile.dataContainer.html(strHTML)},mobile.getSimilarCounties=function(data){for(var keys=["F","S","T","F2","F3"],matches=[],i=0;i<keys.length;i++){var fips=data[keys[i]],match=mobile.lookup(mobile.data,"FIPS",fips);matches.push(match)}mobile.renderSimilarCounties(matches)},mobile.renderSimilarCounties=function(arrayCounties){var $countyList=$(".county-list");$countyList.empty();for(var i=0;i<arrayCounties.length;i++){var county=arrayCounties[i],itemTemplate="<li class='county-item' data-fips='"+county.FIPS+"'>"+county.CTY+", "+county.ST+"</li>";$countyList.eq(0).append(itemTemplate)}$(".county-item").on("click",function(){Analytics.click("Related County Clicked");var $this=$(this),fips=$this.data("fips"),newCounty=mobile.lookup(mobile.data,"FIPS",fips);mobile.setPanelInfo(newCounty),window.scrollTo(0,0)})},mobile.calcPercent=function(num){return Math.round(1e3*num)/10+"%"},mobile.numberWithCommas=function(x){if(x){var parts=x.toString().split(".");return parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),parts.join(".")}return""},mobile.drawChart=function(prop){if(null!==prop){var numComplete=prop.Complete,numEnroll=parseInt(prop.Enrollment);mobile.arrDataNumbers.eq(0).html(isNaN(numEnroll)?"NA":mobile.numberWithCommas(numEnroll)),isNaN(numComplete)||""===numComplete?(numComplete=-1,mobile.arrDataNumbers.eq(1).html("NA")):(numComplete=Math.round(1e4*prop.Complete)/100,mobile.arrDataNumbers.eq(1).html(numComplete.toString()+'<span class="small_pct">%</span>'));var arrRace=[];arrRace[0]=[{label:"Complete",value:numComplete},{label:"Incomplete",value:100-numComplete}],$el=$(".data-charts");var w=mobile.arrPies.eq(0).width(),h=w,r=w/2;mobile.arrPies.height(h),$el.height(h),mobile.arrPies.empty();var vis,pie,arc,arcs,data=[],color=d3.scale.ordinal().range(["#156283","#ffffff"]);-1!==numComplete?(jQuery.each(arrRace,function(index){data=arrRace[index],vis=d3.select("#pie"+index.toString()).append("svg:svg").data([data]).attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+r+","+r+")"),pie=d3.layout.pie().value(function(d){return d.value}),arc=d3.svg.arc().outerRadius(r),arcs=vis.selectAll("g.slice").data(pie).enter().append("svg:g").attr("class","slice"),arcs.append("svg:path").attr("fill",function(d,i){return color(i)}).attr("d",function(d){return arc(d)})}),mobile.arrPies.removeClass("hide")):mobile.arrPies.addClass("hide")}},mobile.calcExtent=function(array1,array2,key){var min=d3.min([d3.min(array1,function(d){return d[key]}),d3.min(array2,function(d){return d[key]})]),max=d3.max([d3.max(array1,function(d){return d[key]}),d3.max(array2,function(d){return d[key]})]);return[min,max]},mobile.lookup=function(array,key,value){var result=_.find(array,function(entry){return entry[key]==value});return result},mobile.listen=function(){$(window).on("resize",function(){mobile.drawChart(mobile.currentFocus)})},$(document).ready(function(){var blnIframeEmbed=window!=window.parent;blnIframeEmbed&&($("body").addClass("iFrame"),$("#header").hide(),$(".mobile-footer-link").hide(),$(".article-button").hide()),mobile.listen(),mobile.panelWrap.eq(0).hide(),window.setTimeout(function(){$(".preloader-mobile").eq(0).fadeOut(500)},1e3)}),function(){var searchApp=angular.module("dataSearch",[]).config(["$compileProvider",function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|javascript):/)}]);searchApp.controller("SearchController",function($http,$scope,$filter){$scope.companies=[],$scope.stateOptions=[{state:"State"},{state:"AZ"},{state:"CA"},{state:"FL"},{state:"ID"},{state:"IL"},{state:"MA"},{state:"MN"},{state:"NC"},{state:"NY"},{state:"RI"},{state:"VA"},{state:"VT"},{state:"WV"}],$scope.stateItem={states:$scope.stateOptions[0]},this.loadStateData=function(){mobile.panelWrap.eq(0).hide(),mobile.stateMenu.eq(0).children("option:selected").index()>0?(mobile.chatterBox.html(mobile.arrStateText[mobile.stateMenu.eq(0).children("option:selected").index()-1]),$http.get("js/data/"+mobile.stateMenu.eq(0).children("option:selected").text().toLowerCase()+".json").then(function(data){mobile.data=data.data,$scope.data=data.data})):mobile.chatterBox.html("Use the search section above to find your school."),mobile.chatterBox.show()},this.checkMenu=function(){return"0"!=mobile.stateMenu.val()?!0:!1},this.blur=function(){$scope.filterTerm=""},this.setFocus=function(focusItem){Analytics.click("School selected"),mobile.currentFocus=focusItem,mobile.setPanelInfo(focusItem),$scope.isFormOpen=!1,$scope.filterTerm="",jQuery(window).on("resetSearch",function(){$scope.filterTerm="",mobile.searchCont.find("input").val("")}),$scope.setShare(focusItem)},this.clear=function(){$scope.filterTerm="",mobile.setPanelInfo(null)},this.mobileSearch=function(){Analytics.click("Typed in search box"),mobile.panelWrap.eq(0).hide(),$scope.filteredArray=$filter("filter")($scope.data,$scope.filterTerm,!1),$scope.filteredArray.length>400&&($scope.filteredArray.length=0),0===$scope.filteredArray.length?mobile.chatterBox.show():mobile.chatterBox.hide(),""!==$scope.filterTerm?(mobile.currentFocus=null,$scope.isFormOpen=!0):($scope.isFormOpen=!1,mobile.chatterBox.show())},$scope.showShare=function(){$(".panel-inner-wrap").addClass("blur"),$(".share-page").addClass("show")},$scope.hideShare=function(){$(".panel-inner-wrap").removeClass("blur"),$(".share-page").removeClass("show")},$scope.showInfo=function(){$(".panel-inner-wrap").addClass("blur"),$(".info-page").addClass("show")},$scope.hideInfo=function(){$(".panel-inner-wrap").removeClass("blur"),$(".info-page").removeClass("show")},$scope.setShare=function(schoolObj){{var copy,encodedURL,encodedURL2,encodedStr,encodedStrTE;encodeURIComponent("http://www.gannett-cdn.com/experiments/usatoday/2015/02/measles/")}schoolObj?(copy="My school, "+schoolObj.Name+" in "+schoolObj.City+", "+schoolObj.State+",  has a complete vaccination rate of "+(Math.round(1e4*schoolObj.Complete)/100).toString()+". Look up your school.",encodedURL=encodeURIComponent("http://www.gannett-cdn.com/experiments/usatoday/2015/02/measles/index.html"),encodedURL2=encodeURI("http://www.gannett-cdn.com/experiments/usatoday/2015/02/measles/index.html"),encodedStr=encodeURIComponent(copy),encodedStr=encodeURI(encodedStr),encodedStrTE=encodeURIComponent(copy)):(copy="How vaccinated are your local schools? Look up their rates @USATODAY",encodedURL=encodeURIComponent("http://www.gannett-cdn.com/experiments/usatoday/2015/02/measles/index.html"),encodedURL2=encodeURI("http://www.gannett-cdn.com/experiments/usatoday/2015/02/measles/index.html"),encodedStr=encodeURIComponent(copy),encodedStr=encodeURI(encodedStr),encodedStrTE=encodeURIComponent(copy));var encodedTitle=encodeURIComponent("School Vaccination Rate"),tweetUrl=(encodeURIComponent("http://www.gannett-cdn.com/usatoday/_common/_dialogs/fb-share-done.html"),"https://twitter.com/intent/tweet?url="+encodedURL+"&text="+encodedStrTE),fbUrl="javascript: var sTop=window.screen.height/2-(218);var sLeft=window.screen.width/2-(313);window.open('https://www.facebook.com/dialog/feed?display=popup&app_id=215046668549694&link="+encodedURL2+"&picture=http://www.gannett-cdn.com/experiments/usatoday/2015/02/measles/img/fb-share.jpg&name="+encodedTitle+"&description="+encodedStr+"&redirect_uri=http://www.gannett-cdn.com/experiments/usatoday/_common/_dialogs/fb-share-done.html','sharer','toolbar=0,status=0,width=580,height=400,top='+sTop+',left='+sLeft);Analytics.click('Facebook share');void(0);",emailURL="mailto:?body="+encodedStrTE+"%0d%0d"+encodedURL+"&subject="+encodedTitle;$scope.share={copy:copy,tweetUrl:tweetUrl,fbUrl:fbUrl,emailURL:emailURL}},$scope.setShare(null)})}();
//# sourceMappingURL=app.min.map